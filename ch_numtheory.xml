<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns:xi="http://www.w3.org/2001/XInclude" xml:id="ch_numtheory">
  <title>Some Classic Number Theory</title>


  <xi:include href="./sec_numtheory_divides.xml"/>
  <xi:include href="./sec_numtheory_modularexp.xml"/>

  <section xml:id="section-numtheory-euclid">
    <title>Prime Numbers and Greatest Common Divisors</title>

    <definition>
      <statement>
        <p>
          A positive integer <m>p</m> is called <term>prime</term> if the only positive factors of <m>p</m> are <m>1 \and p</m> itself.
        </p>
        <p>
          A positive integer which is not prime is called <m>composite</m>
        </p>
      </statement>
    </definition>

    <note>
      <statement>
        <p>
          1 is neither prime nor composite. It's called a <term>unit</term>.
        </p>
      </statement>
    </note>

    <theorem>
      <title>
        The Fundamental Theorem of Arithmetic
      </title>
      <statement>
        <p>
          Every integer greater than 1 can be written as a product of primes, and this product is unique up to the ordering of the prime factors.
        </p>
      </statement>
    </theorem>

    <example>
      <statement>
        <p>
          Find the prime factorization of the following:
          <ol>
            <li> 124 </li>
            <li> 81 </li>
            <li> 941 </li>
          </ol>
        </p>
      </statement>
    </example>


    <theorem>
      <statement>
        <p>
          If <m>n</m> is a composite number, then <m>n</m> has a prime divisor less than or equal to <m>\sqrt{n}</m>.
        </p>
      </statement>
      <proof>
        <statement>
          <p>
            Assume, to the contrary, that every prime divisor of <m>n</m> is greater than <m>\sqrt{n}</m>. Since <m>n</m> is composite, it has at least two prime factors, <m>p_1, p_2</m> so that <m>n = p_1 p_2 b</m> where <m>b</m> is positive integer. But since <m>p_1 \and p_2</m> are a prime divisors of <m>n</m>, they are necessarily larger than  <m>\sqrt{n}</m>. So:
            <me> n = p_1  p_2  b \gt \sqrt{n} \cdot \sqrt{n} \cdot b = nb</me>
            But since <m>n</m> is composite and <m>b\in \Z^+</m>, <m>n\gt nb</m> is a contradiction.
          </p>
        </statement>
      </proof>
    </theorem>

    <example>
      <title>Brute Force Trial Division</title>
      <statement>
        <p>
          To determine if a number <m>n</m> is prime, one only needs to test all possible prime divisors up to <m>\sqrt{n}</m>.
        </p>
        <p>
          Use trial division to determine that 251 is prime.
        </p>
      </statement>
    </example>

    <example>
      <title>Sieve of Eratosthenes</title>
      <statement>
        <p>
          In order to generate a list of all prime numbers less than or equal to <m>n</m>, start with a tabular listing  of integers from 1 to <m>n</m>:
          <ol>
            <li> Cross off the number 1. </li>
            <li>
              <p>
                Continuing until you reach <m>\sqrt{n}</m>:
                <ol>
                  <li> Circle the next, non-crossed out number. It's prime. </li>
                  <li> Cross out every multiple of this number. </li>
                  <li> Repeat. </li>
                </ol>
              </p>
            </li>
          </ol>

        </p>
        <p>
          Run the Sieve on this table of integers from 1 to 100.
        </p>

        <table>
          <caption>Integers from 1 to 100</caption>
          <tabular>
            <row>
              <cell>
                1
              </cell>
              <cell>
                2
              </cell>
              <cell>
                3
              </cell>
              <cell>
                4
              </cell>
              <cell>
                5
              </cell>
              <cell>
                6
              </cell>
              <cell>
                7
              </cell>
              <cell>
                8
              </cell>
              <cell>
                9
              </cell>
              <cell>
                10
              </cell>
            </row>
            <row>
              <cell>
                11
              </cell>
              <cell>
                12
              </cell>
              <cell>
                13
              </cell>
              <cell>
                14
              </cell>
              <cell>
                15
              </cell>
              <cell>
                16
              </cell>
              <cell>
                17
              </cell>
              <cell>
                18
              </cell>
              <cell>
                19
              </cell>
              <cell>
                20
              </cell>
            </row>
            <row>
              <cell>
                21
              </cell>
              <cell>
                22
              </cell>
              <cell>
                23
              </cell>
              <cell>
                24
              </cell>
              <cell>
                25
              </cell>
              <cell>
                26
              </cell>
              <cell>
                27
              </cell>
              <cell>
                28
              </cell>
              <cell>
                29
              </cell>
              <cell>
                30
              </cell>
            </row>
            <row>
              <cell>
                31
              </cell>
              <cell>
                32
              </cell>
              <cell>
                33
              </cell>
              <cell>
                34
              </cell>
              <cell>
                35
              </cell>
              <cell>
                36
              </cell>
              <cell>
                37
              </cell>
              <cell>
                38
              </cell>
              <cell>
                39
              </cell>
              <cell>
                40
              </cell>
            </row>
            <row>
              <cell>
                41
              </cell>
              <cell>
                42
              </cell>
              <cell>
                43
              </cell>
              <cell>
                44
              </cell>
              <cell>
                45
              </cell>
              <cell>
                46
              </cell>
              <cell>
                47
              </cell>
              <cell>
                48
              </cell>
              <cell>
                49
              </cell>
              <cell>
                50
              </cell>
            </row>
            <row>
              <cell>
                51
              </cell>
              <cell>
                52
              </cell>
              <cell>
                53
              </cell>
              <cell>
                54
              </cell>
              <cell>
                55
              </cell>
              <cell>
                56
              </cell>
              <cell>
                57
              </cell>
              <cell>
                58
              </cell>
              <cell>
                59
              </cell>
              <cell>
                60
              </cell>
            </row>
            <row>
              <cell>
                61
              </cell>
              <cell>
                62
              </cell>
              <cell>
                63
              </cell>
              <cell>
                64
              </cell>
              <cell>
                65
              </cell>
              <cell>
                66
              </cell>
              <cell>
                67
              </cell>
              <cell>
                68
              </cell>
              <cell>
                69
              </cell>
              <cell>
                70
              </cell>
            </row>
            <row>
              <cell>
                71
              </cell>
              <cell>
                72
              </cell>
              <cell>
                73
              </cell>
              <cell>
                74
              </cell>
              <cell>
                75
              </cell>
              <cell>
                76
              </cell>
              <cell>
                77
              </cell>
              <cell>
                78
              </cell>
              <cell>
                79
              </cell>
              <cell>
                80
              </cell>
            </row>
            <row>
              <cell>
                81
              </cell>
              <cell>
                82
              </cell>
              <cell>
                83
              </cell>
              <cell>
                84
              </cell>
              <cell>
                85
              </cell>
              <cell>
                86
              </cell>
              <cell>
                87
              </cell>
              <cell>
                88
              </cell>
              <cell>
                89
              </cell>
              <cell>
                90
              </cell>
            </row>
            <row>
              <cell>
                91
              </cell>
              <cell>
                92
              </cell>
              <cell>
                93
              </cell>
              <cell>
                94
              </cell>
              <cell>
                95
              </cell>
              <cell>
                96
              </cell>
              <cell>
                97
              </cell>
              <cell>
                98
              </cell>
              <cell>
                99
              </cell>
              <cell>
                100
              </cell>
            </row>
          </tabular>
        </table>
      </statement>
    </example>


    <theorem>
      <statement>
        <p>
          There are infinitely many primes.
        </p>
      </statement>
    </theorem>

    <exercises>

      <exercise>
        <statement>
          <p>
            Find the prime factorization of each of the following integers:
            <ol>
              <li>39  </li>
              <li>125  </li>
              <li>101  </li>
              <li>143  </li>
              <li>289  </li>
              <li>899  </li>
            </ol>
          </p>
        </statement>
      </exercise>

      <exercise>
        <statement>
          <p>
            Find the prime factorization of <m>10!</m>
          </p>
        </statement>
      </exercise>

    </exercises>

    <subsection xml:id="sec_numtheory_gcds">
      <title>
        GCDs and the Euclidean Algorithm
      </title>

      <definition>
        <statement>
          <p>
            Let <m>a \and b</m> be integers, not both zero. The largest integer <m>d</m> such that <m>d\divides a</m> and <m>d \divides b</m> is called the <term>greatest common divisor of <m>a \and b</m></term> which we denote by <m>\gcd(a,b)</m>.
          </p>
          <p>
            We say <m>a \and b</m> are <term>relatively prime </term> if <m>\gcd(a,b)=1</m>.
          </p>
        </statement>
      </definition>

      <example>
        <statement>
          <p>
            Find the following (by listing prime factors):
            <ol>
              <li> <m>\gcd(36, 69)</m> </li>
              <li> <m>\gcd(10, 27)</m> </li>
              <li> <m>\gcd(360, 1000)</m> </li>
            </ol>
          </p>
        </statement>
      </example>

      <definition>
        <statement>
          <p>
            Let <m>a \and b</m> be integers, not both zero. The smallest integer <m>m</m> such that <m>a\divides m</m> and <m>b \divides m</m> is called the <term>least common multiple of <m>a \and b</m></term> which we denote by <m>\lcm(a,b)</m>.
          </p>
        </statement>
      </definition>


      <example>
        <statement>
          <p>
            Find the following:
            <ol>
              <li> <m>\lcm(36, 69)</m> </li>
              <li> <m>\lcm(10, 27)</m> </li>
              <li> <m>\lcm(360, 1000)</m> </li>
            </ol>
          </p>
        </statement>
      </example>

      <theorem>
        <statement>
          <p>
            Let <m>a \and b</m> be two positive integers. Then
            <me>ab = \gcd(a,b)\cdot \lcm(a,b)</me>
          </p>
        </statement>
      </theorem>


      <theorem xml:id="euclidean-algorithm">
        <title>The Euclidean Algorithm</title>
        <statement>
          <p>
            Let <m>a=r_0</m> and <m>b=r_1</m> be two positive integers where <m>a \ge b</m>. If we apply the division algorithm recursively so that
            <me> r_j = r_{j+1} q_{j+1} + r_{j+2} \text{ where } 0 \le r_{j+2} \lt r_{j+1}</me>
            for all <m>j = 0, 1, 2, \dots, n-2</m>, and <m>r_{n+1} = 0</m>, then <m>\gcd(a,b) = r_n</m>.
          </p>
        </statement>
      </theorem>

      <example>
        <statement>
          <p>
            Here's a fully worked out example showing how to run the algorithm to find <m>\gcd(7592, 5913)</m>
          </p>
        </statement>
        <solution>
          <p>
            <md>
              <mrow>7592 &amp;= 5913 \cdot 1 + 1679</mrow>
              <mrow>5913 &amp;= 1679 \cdot 3 + 876</mrow>
              <mrow>1679 &amp;= 876 \cdot 1 + 803 </mrow>
              <mrow>876 &amp;= 803 \cdot 1 + 73 </mrow>
              <mrow>803 &amp;= 73 \cdot 11 + 0 </mrow>
            </md>
            According to the Euclidean Algorithm, the last non-zero remainder is the gcd, and so <m>\gcd(7592, 5913) = 73</m>.
          </p>
        </solution>
      </example>
      
      <theorem>
        <!-- TODO, give him a grave accent -->
        <title>Bezout's Theorem</title>
        <statement>
          <p>
            If <m>a \and b</m> are positive integers, then there exist integers <m>s \and t</m> such that <m>{\gcd(a,b) = as + bt}</m>
          </p>
        </statement>
      </theorem>

      <definition>
        <statement>
          <p>
            We call <m>s \and t</m> in the theorem above the <term>Bezout coefficients</term> of <m>a \and b</m>. 
          </p>
        </statement>
      </definition>

      <example>
        <title>Back Substition</title>
        <statement>
          <p>
            We can reverse the Euclidean Algorithm to find the Bezout coefficients, a process that we'll call <term>back substitution</term>. We solve each equation in the Euclidean Algorithm for the remainder, and repeatedly substitute and combine like terms until we arrive at the gcd written as a <term>linear combination</term> of the original two numbers, in this case, <m>73 = 7592s + 5913t</m>
          </p>
        </statement>
        <solution>
          <p>
            <sidebyside widths="45% 45%">
              <p>
                The remainders:
                <md>
                  <mrow>73 &amp;= 876 - 803 \cdot 1</mrow>
                  <mrow>803 &amp;= 1679 - 876 \cdot 1 </mrow>
                  <mrow>876 &amp;= 5913 - 1679 \cdot 3 </mrow>
                  <mrow>1679 &amp;= 7592 - 5913 \cdot 1</mrow>
                </md>
              </p>
              <p>
                Substition and combining like terms:
                <md>
                  <mrow>73 &amp;= 876 - 803 \cdot 1</mrow>
                  <mrow> &amp;= 876 - (1679 - 876 \cdot 1) \cdot 1</mrow>
                  <mrow> &amp;= 876\cdot 2 - 1679 \cdot 1</mrow>
                  <mrow> &amp;= (5913 - 1679\cdot 3) \cdot 2 - 1679 \cdot 1</mrow>
                  <mrow> &amp;= 5913\cdot 2 - 1679 \cdot 7</mrow>
                  <mrow> &amp;= 5913\cdot 2 - (7592 - 5913 \cdot 1) \cdot 7</mrow>
                  <mrow> &amp;= 5913\cdot 9 - 7592 \cdot 7</mrow>
                  <mrow> &amp;= 5913\cdot 9 + 7592 \cdot (-7)</mrow>
                </md>
              </p>
            </sidebyside>
            So <m>73 = 5913 \cdot 9 + 7592 \cdot(-7)</m> is the linear combination we desired.
          </p>
        </solution>
      </example>


      <example>
        <statement>
          <p>
            <ol>
              <li>
                Use the Euclidean algorithm to find <m>\gcd(4147, 10672)</m>.
              </li>
              <li>
                Use back-substitution (reverse the steps of the Euclidean Algorithm) to write the greatest common divisor of 4147 and 10672 as a linear combination of those numbers.
              </li>
            </ol>
          </p>
        </statement>
      </example>

      <exercises>
        <exercise>
          <statement>
            <p>
              Find the gcd via the Euclidean Algorithm and then use back-substitution to write the gcd as a linear combination of those numbers:
              <ol>
                <li><m> \gcd(36, 48) </m></li>
                <li><m> \gcd(21, 724) </m></li>
                <li><m> \gcd(60, 97) </m></li>
                <li><m> \gcd(5, 26) </m></li>
              </ol>
            </p>
          </statement>
        </exercise>

        <exercise>
          <statement>
            <p>
              Use any method to find the greatest common divisor of 412 and 32.
            </p>
          </statement>
        </exercise>

        <exercise>
          <statement>
            <p>
              Use any method to find the greatest common divisor of 780 and 150.
            </p>
          </statement>
        </exercise>

        <exercise>
          <statement>
            <p>
              Find the greatest common divisor of 70, 98, 108.
            </p>
          </statement>
        </exercise>
      </exercises>

    </subsection>
    <subsection xml:id="numtheory_inverses">
      <title>
        Inverses
      </title>

      <example>
        <statement>
          <p>
            <ol>
              <li> 
                Find every multiple of 4 modulo 9.
              </li>
              <li>
                Find the inverse of 4 modulo 9.
              </li>
            </ol>
          </p>
        </statement>
        <solution>
          <p>
            Here's the multiplication table. Remember to reduce modulo 9. 
            <table>
              <caption>Multiplication table of 4 modulo 9</caption>
              <tabular halign="center">
                <row bottom="medium">
                  <cell right="medium">
                    *
                  </cell>
                  <cell>
                    1
                  </cell>
                  <cell>
                    2
                  </cell>
                  <cell>
                    3
                  </cell>
                  <cell>
                    4
                  </cell>
                  <cell>
                    5
                  </cell>
                  <cell halign="left">
                    6
                  </cell>
                  <cell halign="left">
                    7
                  </cell>
                  <cell halign="left">
                    8
                  </cell>
                  <cell halign="left">
                    9
                  </cell>
                </row>
                <row>
                  <cell right="medium">
                    4
                  </cell>
                  <cell>
                    4
                  </cell>
                  <cell>
                    8
                  </cell>
                  <cell>
                    3
                  </cell>
                  <cell>
                    7
                  </cell>
                  <cell>
                    2
                  </cell>
                  <cell halign="left">
                    6
                  </cell>
                  <cell halign="left">
                    1
                  </cell>
                  <cell halign="left">
                    5
                  </cell>
                  <cell halign="left">
                    0
                  </cell>
                </row>
              </tabular>
            </table>
          </p>
          <p>
            The inverse of 4 modulo 9 is 7. Why?
          </p>
        </solution>
      </example>


      <example>
        <statement>
          <p>
            Solve the congruence <m>4x = 5 \pmod 9 </m>.
          </p>
        </statement>
      </example>

      <example xml:id="multiplication-table">
        <statement>
          <p>
            Let's create a multiplication table modulo 9. The following Sage code does it for us. You can change the variable <c>n</c> to other numbers to quickly generate other multiplication tables.
          </p>
          <p>
            The output is a table/matrix whose <m>i, j</m>th entry is <m>i \cdot j \pmod \text{n}</m>.
            <sage>
              <input>
                n = 9
                rows = []
                for i in range(1, n):
                rows.append( map((lambda x: (i*x)%n), [x for x in range(1,n)]))

                table(rows)
              </input>
              <output>
                1	2	3	4	5	6	7	8
                2	4	6	8	1	3	5	7
                3	6	0	3	6	0	3	6
                4	8	3	7	2	6	1	5
                5	1	6	2	7	3	8	4
                6	3	0	6	3	0	6	3
                7	5	3	1	8	6	4	2
                8	7	6	5	4	3	2	1
              </output>
            </sage>

            <ol>
              <li> What is the inverse of 7 modulo 9? </li>
              <li> Does 6 have an inverse modulo 9? Why or why not?</li>
              <li> What numbers are invertible modulo 9? What numbers are not?</li>
            </ol>
          </p>
        </statement>
      </example>

      <theorem>
        <statement>
          <p>
            If <m>a \and m</m> are relatively prime integers and <m>m \gt 1</m>, then an inverse of <m>a</m> modulo <m>m</m> exists.
          </p>
        </statement>
      </theorem>

      <note>
        <statement>
          <p>
            <ol>
              <li> The inverse of <m>a \text{ modulo } m</m> is its Bezout coefficient in <m>{\gcd(a,m) = as + mt}</m> </li>
              <li> The inverse is unique, but we won't prove that here.</li>
            </ol>
          </p>
        </statement>
      </note>

      <exercises>
        <exercise>
          <statement>
            <p>
              Solve the congruence:
              <ol>
                <li><m> 3x + 4 = 7 \pmod 8 </m></li>
                <li><m> 9x = 4 \pmod{22}</m></li>
                <li><m> 5x + 14 = 0 \pmod{26}</m></li>
              </ol>
            </p>
          </statement>
        </exercise>


        <exercise>
          <statement>
            <p>
              Find all solutions to the congruence (there could be more than one):
              <ol>
                <li> <m>3x =6 \pmod 9 </m></li>
                <li> <m>4x = 3 \pmod 8 </m></li>
              </ol>
            </p>
          </statement>
        </exercise>


        <exercise>
          <statement>
            <p>
              Play around with making <xref ref="multiplication-table">multiplication tables of various moduli in the Sage code in example</xref>.
              <ol>
                <li> What condition is required for a number <m>a</m> to have an inverse modulo <m>n</m>? </li>
                <li> What is a condition on <m>n</m> for every element to have an inverse modulo <m>n</m>?</li>
              </ol>
            </p>
          </statement>
        </exercise>

      </exercises>
    </subsection>


  </section>


  <xi:include href="./sec_numtheory_encryption.xml"/>


</chapter>

